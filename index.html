<!-- A1 - Andrew Nolan-->

<!--Sources:-->
<!-- https://www.youtube.com/watch?v=-RQWC4I2I1s&list=WL&index=1 -->
<!-- https://stackoverflow.com/questions/42878866/using-d3-slider-to-change-attribute -->
<!-- https://en.wikipedia.org/wiki/Chernoff_face -->

<!--Atleast 4 primitives-->
<!--Circles - eyes-->
<!--Rectanges - eyebrows-->
<!--Polygon - nose-->
<!--Line - sliders-->
<!--Ellipses - head-->

<script src="https://d3js.org/d3.v6.min.js"></script>

<head>
  <title>CS 573 - A1</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <h1>Chernoff Faces</h1>
  <div id="svgZone"></div>
</body>

<script>
  // Try to make chernoff faces
  const svgContainer = d3.select("#svgZone")
    .append("svg")
    .attr("width", 640)
    .attr("height", 480)
    .style("background-color", "lightblue");

  // The head, an ellipse
  let headRadiusX = 100;
  let headRadiusY = 100;
  let headCenterX = 250;
  let headCenterY = 250;
  let headColor = "yellow";
  let headStrokeColor = "black";

  const head = svgContainer.append("ellipse")
    .attr("cx",headCenterX)
    .attr("cy",headCenterY)
    .attr("rx",headRadiusX)
    .attr("ry",headRadiusY)
    .attr("fill",headColor)
    .attr("stroke",headStrokeColor);

  // The eyes, circles
  let eyeGroupTranslationX = 250;
  let eyeGroupTranslationY = 200;
  let eyeRadius = 10;
  let eyeSeparation = 50;
  let eyeFillColor = "black";

  const eyeGroup = svgContainer.append('g')
    .attr('transform', 'translate('+eyeGroupTranslationX+','+eyeGroupTranslationY+')');

  const leftEye = eyeGroup.append('circle')
    .attr("r", eyeRadius)
    .attr("cx", -eyeSeparation)
    .attr("fill",eyeFillColor);

  const rightEye = eyeGroup.append('circle')
    .attr("r", eyeRadius)
    .attr("cx", eyeSeparation)
    .attr("fill",eyeFillColor);

  // The eyebrows, rectangles
  let browWidth = 30;
  let browHeight= 10;
  let browX = 30;
  let browY = -25;

  const leftEyebrow = eyeGroup.append('rect')
    .attr('width',browWidth)
    .attr('height',browHeight)
    .attr('x',-browX-browWidth)
    .attr('y', browY);

  const rightEyebrow = eyeGroup.append('rect')
    .attr('width',browWidth)
    .attr('height',browHeight)
    .attr('x', browX)
    .attr('y', browY);

  // The smile, a path
  let smileTranslateX = 250;
  let smileTranslateY = 250;
  let smileInnerRadius = 35;
  let smileOuterRadius = 60;
  let smileStartAngle = Math.PI/2;
  let smileEndAngle = Math.PI * 3 / 2;

  const smileGroup = svgContainer.append('g')
    .attr('transform', 'translate('+smileTranslateX+', '+smileTranslateY+')');

  const mouth = smileGroup.append("path")
    .attr("d", d3.arc()({
      innerRadius: smileInnerRadius,
      outerRadius: smileOuterRadius,
      startAngle: smileStartAngle,
      endAngle: smileEndAngle
    }));

  // The nose, a polygon
  let nosePoint1 = "250,205";
  let nosePoint2 = "225,225";
  let nosePoint3 = "275,225";
  let noseStrokeColor = "black";
  let noseFillColor = "none";
  let noseStrokeWidth = 5;

  const nose = svgContainer.append("polygon")
    .attr("points", nosePoint1+" "+nosePoint2+" "+nosePoint3)
    .attr("stroke", noseStrokeColor)
    .attr("fill", noseFillColor)
    .attr("stroke-width",noseStrokeWidth);

  // Face shape slider
  let faceWidthScale = d3.scaleLinear()
    .domain([50,150]) // The range of head widths
    .range([0,100]) // slider range is 200 pixels
    .clamp(true); //not sure what this does yet

  let faceWidthSlider = svgContainer.append("g")
    .attr("class","slider") // css thing I think
    .attr("transform","translate(13,50)");

  faceWidthSlider.append("line")
    .attr("class","track")
    .attr("x1",faceWidthScale.range()[0])
    .attr("x2",faceWidthScale.range()[1])
    .select(function(){
      return this.parentNode;
    });

  faceWidthSlider.append("line")
  .attr("x1", faceWidthScale.range()[0])
  .attr("x2", faceWidthScale.range()[1])
  .attr("class", "track-inset")
  .select(function() {
    return this.parentNode;
  });

  faceWidthSlider.append("line")
  .attr("x1", faceWidthScale.range()[0])
  .attr("x2", faceWidthScale.range()[1])
  .attr("class", "track-overlay")
  .call(d3.drag()
    .on("start.interrupt", function() {
      faceWidthSlider.interrupt();
    })
    .on("start drag", function() {
      changeHeadWidth(faceWidthScale.invert(event.x));
  }));

  let faceWidthHandle = faceWidthSlider.insert("circle", ".track-overlay")
    .attr("class", "handle")
    .attr("r", 10)
    .attr("cx",50);
  
  function changeHeadWidth(h) {
    faceWidthHandle.attr("cx", faceWidthScale(h));
    headRadiusX = h;
    head.attr("rx",headRadiusX);
  }

  // Smile shape slider
  let smileShapeScale = d3.scaleLinear()
    .domain([0,50]) // The range of smile inner radii
    .range([0,100]) // slider range is 200 pixels
    .clamp(true); //not sure what this does yet

  let smileShapeSlider = svgContainer.append("g")
    .attr("class","slider") // css thing I think
    .attr("transform","translate(13,100)");

  smileShapeSlider.append("line")
    .attr("class","track")
    .attr("x1",smileShapeScale.range()[0])
    .attr("x2",smileShapeScale.range()[1])
    .select(function(){
      return this.parentNode;
    });

  smileShapeSlider.append("line")
  .attr("x1", smileShapeScale.range()[0])
  .attr("x2", smileShapeScale.range()[1])
  .attr("class", "track-inset")
  .select(function() {
    return this.parentNode;
  });

  smileShapeSlider.append("line")
  .attr("x1", smileShapeScale.range()[0])
  .attr("x2", smileShapeScale.range()[1])
  .attr("class", "track-overlay")
  .call(d3.drag()
    .on("start.interrupt", function() {
      smileShapeSlider.interrupt();
    })
    .on("start drag", function() {
      changeSmileShape(smileShapeScale.invert(event.x));
  }));

    let smileShapeHandle = smileShapeSlider.insert("circle", ".track-overlay")
    .attr("class", "handle")
    .attr("r", 10)
    .attr("cx",70);
  
  function changeSmileShape(h) {
    smileShapeHandle.attr("cx", smileShapeScale(h));
    //smileStartAngle = h;
    //smileEndAngle = h+Math.PI*3/2;
    smileInnerRadius = h;
    mouth.attr("d", d3.arc()({
      innerRadius: smileInnerRadius,
      outerRadius: smileOuterRadius,
      startAngle: smileStartAngle,
      endAngle: smileEndAngle
    }));
  }

  // Nose height slider
  let noseHeightScale = d3.scaleLinear()
    .domain([175,275]) // The range of nose heights
    .range([0,100]) // slider range is 200 pixels
    .clamp(true); //not sure what this does yet

  let noseHeightSlider = svgContainer.append("g")
    .attr("class","slider") // css thing I think
    .attr("transform","translate(13,150)");

  noseHeightSlider.append("line")
    .attr("class","track")
    .attr("x1",noseHeightScale.range()[0])
    .attr("x2",noseHeightScale.range()[1])
    .select(function(){
      return this.parentNode;
    });

  noseHeightSlider.append("line")
  .attr("x1", noseHeightScale.range()[0])
  .attr("x2", noseHeightScale.range()[1])
  .attr("class", "track-inset")
  .select(function() {
    return this.parentNode;
  });

  noseHeightSlider.append("line")
  .attr("x1", noseHeightScale.range()[0])
  .attr("x2", noseHeightScale.range()[1])
  .attr("class", "track-overlay")
  .call(d3.drag()
    .on("start.interrupt", function() {
      noseHeightSlider.interrupt();
    })
    .on("start drag", function() {
      changeNoseHeight(noseHeightScale.invert(event.x));
  }));

    let noseHeightHandle = noseHeightSlider.insert("circle", ".track-overlay")
    .attr("class", "handle")
    .attr("r", 10)
    .attr("cx",30);
  
  function changeNoseHeight(h) {
    noseHeightHandle.attr("cx", noseHeightScale(h));
    nosePoint1 = "250,"+h;
    nose.attr("points", nosePoint1+" "+nosePoint2+" "+nosePoint3);
  }

  // Brow Angle
  let browAngleScale = d3.scaleLinear()
    .domain([-38.1,38.1]) // The range of brow angles
    .range([0,100]) // slider range is 100 pixels
    .clamp(true); //not sure what this does yet

  let browAngleSlider = svgContainer.append("g")
    .attr("class","slider") // css thing I think
    .attr("transform","translate(13,200)");

  browAngleSlider.append("line")
    .attr("class","track")
    .attr("x1",browAngleScale.range()[0])
    .attr("x2",browAngleScale.range()[1])
    .select(function(){
      return this.parentNode;
    });

  browAngleSlider.append("line")
  .attr("x1", browAngleScale.range()[0])
  .attr("x2", browAngleScale.range()[1])
  .attr("class", "track-inset")
  .select(function() {
    return this.parentNode;
  });

  browAngleSlider.append("line")
  .attr("x1", browAngleScale.range()[0])
  .attr("x2", browAngleScale.range()[1])
  .attr("class", "track-overlay")
  .call(d3.drag()
    .on("start.interrupt", function() {
      browAngleSlider.interrupt();
    })
    .on("start drag", function() {
      changeBrowAngle(browAngleScale.invert(event.x));
  }));

  let browAngleHandle = browAngleSlider.insert("circle", ".track-overlay")
    .attr("class", "handle")
    .attr("r", 10)
    .attr("cx",50);
  
  function changeBrowAngle(h) {
    browAngleHandle.attr("cx", browAngleScale(h));
    leftEyebrow.attr("transform","rotate(" + h +","+(-browX-browWidth)+","+browY+")");
    console.log(h);
    rightEyebrow.attr("transform","rotate(" + -h +","+ (browX+browWidth) +","+browY+")");
  }

  // After making the adjustable one make a iris species dataset example

  /** console.log(d3); // test if d3 is loaded **/


  // Add an SVG
  // Add Rectangles
  // Add Circles
  // Add Lines
  // Add Polygons
</script>
